<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mariann drell</title>
  <link rel="stylesheet" href="style.css" />
  <link
    rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50' y='50' font-size='60' font-family='sans-serif' text-anchor='middle' dominant-baseline='central'%3Emd%3C/text%3E%3C/svg%3E"
  />
</head>

<body>
  <header class="header" style="display: flex; align-items: center; justify-content: flex-start; gap: 36px;">
    <div style="display: flex; align-items: center; gap: 24px; width: 100%;">
      <h1 class="title" style="margin-right: 0;">mariann drell</h1>
      <nav class="nav" style="display: flex; flex-direction: column; gap: 8px; align-items: flex-start; min-width: 110px;">
        <a href="#" class="email-toggle" data-email="marianndrell@gmail.com">email</a>
        <a href="https://instagram.com/akudrell" target="_blank" rel="noreferrer">ig</a>
      </nav>
    </div>
    <div class="tag-filters header-tags">
      <button class="tag-button" data-tag="spaces">spaces</button>
      <button class="tag-button" data-tag="subjects">subjects</button>
      <button class="tag-button" data-tag="objects">objects</button>
    </div>
  </header>

  <main class="main">
    <section class="gallery">
      <div class="tile" data-tags="subjects">
        <img src="images/md_0001.webp" alt="" loading="lazy" />
        <div class="meta">henrihenri, 2026</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0002.webp" alt="" loading="lazy" />
        <div class="meta">surnuaed, 2026</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0003.webp" alt="" loading="lazy" />
        <div class="meta">kotzebue, 2026</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0004.webp" alt="" loading="lazy" />
        <div class="meta">riided, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0005.webp" alt="" loading="lazy" />
        <div class="meta">kopenhaagen, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0006.webp" alt="" loading="lazy" />
        <div class="meta">toolid, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0007.webp" alt="" loading="lazy" />
        <div class="meta">uks, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0008.webp" alt="" loading="lazy" />
        <div class="meta">veera, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0009.webp" alt="" loading="lazy" />
        <div class="meta">henri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0010.webp" alt="" loading="lazy" />
        <div class="meta">ivo, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0011.webp" alt="" loading="lazy" />
        <div class="meta">portofino, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0012.webp" alt="" loading="lazy" />
        <div class="meta">henessi säde, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0013.webp" alt="" loading="lazy" />
        <div class="meta">haapsalu, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0014.webp" alt="" loading="lazy" />
        <div class="meta">henri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0015.webp" alt="" loading="lazy" />
        <div class="meta">pann ja henri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0016.webp" alt="" loading="lazy" />
        <div class="meta">sandra ja anumai, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0017.webp" alt="" loading="lazy" />
        <div class="meta">portofino, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0018.webp" alt="" loading="lazy" />
        <div class="meta">zurich, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0019.webp" alt="" loading="lazy" />
        <div class="meta">photoautomat, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0020.webp" alt="" loading="lazy" />
        <div class="meta">hanna, artur, henessi säde, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0021.webp" alt="" loading="lazy" />
        <div class="meta">lauaseade, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0022.webp" alt="" loading="lazy" />
        <div class="meta">linn-masin, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0023.webp" alt="" loading="lazy" />
        <div class="meta">mariann drell, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0024.webp" alt="" loading="lazy" />
        <div class="meta">arhitektid, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0025.webp" alt="" loading="lazy" />
        <div class="meta">ly-ann, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0026.webp" alt="" loading="lazy" />
        <div class="meta">lapsed praamil, portofino, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0027.webp" alt="" loading="lazy" />
        <div class="meta">oxara, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0028.webp" alt="" loading="lazy" />
        <div class="meta">mariin, milano, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0029.webp" alt="" loading="lazy" />
        <div class="meta">milano, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0030.webp" alt="" loading="lazy" />
        <div class="meta">jüri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0031.webp" alt="" loading="lazy" />
        <div class="meta">paul ja rocky, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0032.webp" alt="" loading="lazy" />
        <div class="meta">lennart, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0033.webp" alt="" loading="lazy" />
        <div class="meta">zurich, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0034.webp" alt="" loading="lazy" />
        <div class="meta">ulrikebrett ja victor, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0035.webp" alt="" loading="lazy" />
        <div class="meta">suvi, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0036.webp" alt="" loading="lazy" />
        <div class="meta">sandra maarjamäel, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0037.webp" alt="" loading="lazy" />
        <div class="meta">lennart, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0038.webp" alt="" loading="lazy" />
        <div class="meta">henri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0039.webp" alt="" loading="lazy" />
        <div class="meta">karkudega pargis, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0040.webp" alt="" loading="lazy" />
        <div class="meta">sandra, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0041.webp" alt="" loading="lazy" />
        <div class="meta">henri, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0042.webp" alt="" loading="lazy" />
        <div class="meta">thoravej 29, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0043.webp" alt="" loading="lazy" />
        <div class="meta">henri, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0044.webp" alt="" loading="lazy" />
        <div class="meta">mehed, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0045.webp" alt="" loading="lazy" />
        <div class="meta">maria, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0046.webp" alt="" loading="lazy" />
        <div class="meta">lauaseade itaalias, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0047.webp" alt="" loading="lazy" />
        <div class="meta">kastid auto, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0048.webp" alt="" loading="lazy" />
        <div class="meta">puuviljalett, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0049.webp" alt="" loading="lazy" />
        <div class="meta">kirik, zurich, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0050.webp" alt="" loading="lazy" />
        <div class="meta">bauburo in situ, zurich, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0051.webp" alt="" loading="lazy" />
        <div class="meta">pann, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0052.webp" alt="" loading="lazy" />
        <div class="meta">maria ja mariann ja jalad, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0053.webp" alt="" loading="lazy" />
        <div class="meta">bauburo in situ, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0054.webp" alt="" loading="lazy" />
        <div class="meta">lauaseade kadriorus, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0055.webp" alt="" loading="lazy" />
        <div class="meta">bauburo in situ, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0056.webp" alt="" loading="lazy" />
        <div class="meta">tellingud, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0057.webp" alt="" loading="lazy" />
        <div class="meta">maria ja mariann, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0058.webp" alt="" loading="lazy" />
        <div class="meta">pann, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0059.webp" alt="" loading="lazy" />
        <div class="meta">lennart, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0060.webp" alt="" loading="lazy" />
        <div class="meta">tellingud, firenze, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0061.webp" alt="" loading="lazy" />
        <div class="meta">gym, kopenhaagen 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0062.webp" alt="" loading="lazy" />
        <div class="meta">zurich, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0063.webp" alt="" loading="lazy" />
        <div class="meta">nike shox, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0064.webp" alt="" loading="lazy" />
        <div class="meta">mariann, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0065.webp" alt="" loading="lazy" />
        <div class="meta">lauaseade, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0066.webp" alt="" loading="lazy" />
        <div class="meta">ulrikese fresco, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0067.webp" alt="" loading="lazy" />
        <div class="meta">pann ja juss, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0068.webp" alt="" loading="lazy" />
        <div class="meta">eth zurich, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0069.webp" alt="" loading="lazy" />
        <div class="meta">mustamäe, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0070.webp" alt="" loading="lazy" />
        <div class="meta">köök, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0071.webp" alt="" loading="lazy" />
        <div class="meta">eth zurich, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0072.webp" alt="" loading="lazy" />
        <div class="meta">ikoon ja raamatud, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0073.webp" alt="" loading="lazy" />
        <div class="meta">lauaseade, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0074.webp" alt="" loading="lazy" />
        <div class="meta">mustamäe, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0075.webp" alt="" loading="lazy" />
        <div class="meta">makett ja käsi, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0076.webp" alt="" loading="lazy" />
        <div class="meta">punane diivan, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0077.webp" alt="" loading="lazy" />
        <div class="meta">mariin, lotte, jüri, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0078.webp" alt="" loading="lazy" />
        <div class="meta">mustamäe, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0079.webp" alt="" loading="lazy" />
        <div class="meta">wolkswagen, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0080.webp" alt="" loading="lazy" />
        <div class="meta">just cavalli, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0081.webp" alt="" loading="lazy" />
        <div class="meta">kopenhaagen, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0082.webp" alt="" loading="lazy" />
        <div class="meta">fontään, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0083.webp" alt="" loading="lazy" />
        <div class="meta">vihmavesi, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0084.webp" alt="" loading="lazy" />
        <div class="meta">donna karan new york, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0085.webp" alt="" loading="lazy" />
        <div class="meta">boltshauser köök, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0086.webp" alt="" loading="lazy" />
        <div class="meta">kotzebue, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0087.webp" alt="" loading="lazy" />
        <div class="meta">artur ja henessi säde, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0088.webp" alt="" loading="lazy" />
        <div class="meta">artemide nesso ja köök, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0089.webp" alt="" loading="lazy" />
        <div class="meta">pidu lõppeb, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0090.webp" alt="" loading="lazy" />
        <div class="meta">pann ja mariann, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0091.webp" alt="" loading="lazy" />
        <div class="meta">annagrete ja kaarel voodis, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0092.webp" alt="" loading="lazy" />
        <div class="meta">sandra, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0093.webp" alt="" loading="lazy" />
        <div class="meta">maria, arvi, karl erik, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0094.webp" alt="" loading="lazy" />
        <div class="meta">uni trammis, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0095.webp" alt="" loading="lazy" />
        <div class="meta">annagrete ja karl erik, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0096.webp" alt="" loading="lazy" />
        <div class="meta">romants, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0097.webp" alt="" loading="lazy" />
        <div class="meta">pann ja sanna, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0098.webp" alt="" loading="lazy" />
        <div class="meta">lasnamäe ringmajanduskeskus, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0099.webp" alt="" loading="lazy" />
        <div class="meta">lauseade, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0100.webp" alt="" loading="lazy" />
        <div class="meta">maria jalad, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0101.webp" alt="" loading="lazy" />
        <div class="meta">viru hotell, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0102.webp" alt="" loading="lazy" />
        <div class="meta">jüri, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0103.webp" alt="" loading="lazy" />
        <div class="meta">viru parkla, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0104.webp" alt="" loading="lazy" />
        <div class="meta">maria, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0105.webp" alt="" loading="lazy" />
        <div class="meta">lasnamäe ringmajanduskeskus, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0106.webp" alt="" loading="lazy" />
        <div class="meta">riiul, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0107.webp" alt="" loading="lazy" />
        <div class="meta">maria, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0108.webp" alt="" loading="lazy" />
        <div class="meta">lasnamäe ringmajanduskeskus, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0109.webp" alt="" loading="lazy" />
        <div class="meta">pann ja juss, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0110.webp" alt="" loading="lazy" />
        <div class="meta">köök, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0111.webp" alt="" loading="lazy" />
        <div class="meta">trammis, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0112.webp" alt="" loading="lazy" />
        <div class="meta">köök, 2025</div>
      </div>
      <div class="tile" data-tags="spaces">
        <img src="images/md_0113.webp" alt="" loading="lazy" />
        <div class="meta">mäed ja udu, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0114.webp" alt="" loading="lazy" />
        <div class="meta">peegel ja kapp, 2025</div>
      </div>
      <div class="tile" data-tags="objects">
        <img src="images/md_0115.webp" alt="" loading="lazy" />
        <div class="meta">kapinupud, 2025</div>
      </div>
      <div class="tile" data-tags="subjects">
        <img src="images/md_0116.webp" alt="" loading="lazy" />
        <div class="meta">lennart ja jüri, 2025</div>
      </div>
    </section>
  </main>

  <div class="gallery-hint">click = preview · shift+click = info</div>

  <footer class="footer">
    <p>© <span id="year"></span> Mariann Drell</p>
  </footer>

  <!-- Lightbox / Supersized viewer -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="lightbox-close" id="lightboxClose" aria-label="Close">md</button>

    <img class="lightbox-img" id="lightboxImg" alt="" />

    <div class="lightbox-meta" id="lightboxMeta" aria-hidden="true"></div>

    <div class="lightbox-arrow" id="lightboxArrow"></div>

    <div class="lightbox-hint" id="lightboxHint">
      ← prev · next → · space = info · f = fit · esc = close
    </div>
  </div>

  <script>
    // Set current year
    document.getElementById("year").textContent = new Date().getFullYear();

    const gallery = document.querySelector(".gallery");
    const tiles = Array.from(document.querySelectorAll(".tile"));
    const tagButtons = document.querySelectorAll(".tag-button");
    const title = document.querySelector(".title");
    const nav = document.querySelector(".nav");

    let lastScrollY = 0;
    let headerHidden = false;
    const SCROLL_THRESHOLD = 8;

    window.addEventListener("scroll", () => {
      const y = window.scrollY;
      const delta = y - lastScrollY;
      if (delta > SCROLL_THRESHOLD && !headerHidden) {
        headerHidden = true;
        title.style.opacity = "0";
        nav.style.opacity = "0";
      } else if (delta < -SCROLL_THRESHOLD && headerHidden) {
        headerHidden = false;
        title.style.opacity = "1";
        nav.style.opacity = "1";
      }
      if (Math.abs(delta) > SCROLL_THRESHOLD) lastScrollY = y;
    });

    // Lightbox elements
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lightboxMeta = document.getElementById("lightboxMeta");
    const lightboxClose = document.getElementById("lightboxClose");

    let activeTiles = [];
    let currentIndex = 0;

    // Viewer state
    let isOpen = false;
    let showMeta = false;
    let fitContain = false; // default: cover (Squoosh feel)

    const EAGER_COUNT = 9;

    function shuffleAndLayout() {
      const shuffled = tiles
        .map(item => ({ item, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ item }) => item);

      shuffled.forEach(tile => gallery.appendChild(tile));

      const images = shuffled.map(t => t.querySelector("img")).filter(Boolean);
      images.forEach((img, i) => {
        if (i < EAGER_COUNT) img.loading = "eager";
        if (img.complete) img.classList.add("is-loaded");
        else img.addEventListener("load", () => img.classList.add("is-loaded"), { once: true });
      });
    }

    shuffleAndLayout();

    const MIN_COLS = 3;
    const MAX_COLS = 8;
    let cols = window.innerWidth < 768 ? 3 : 3;
    let scale = 1;
    let targetScale = 1;
    let animating = false;
    const SNAP_UP = 1.2;
    const SNAP_DOWN = 0.83;
    const LERP = 0.12;
    const MAX_VELOCITY = 0.06;

    document.documentElement.style.setProperty("--cols", cols);
    gallery.style.transformOrigin = "top left";
    gallery.style.willChange = "transform";

    function tickZoom() {
      scale += (targetScale - scale) * LERP;

      let snapped = false;
      if (scale >= SNAP_UP && cols > MIN_COLS) {
        cols--;
        document.documentElement.style.setProperty("--cols", cols);
        const overshoot = targetScale - SNAP_UP;
        targetScale = 1 + overshoot * 0.5;
        scale = 1;
        snapped = true;
      } else if (targetScale <= SNAP_DOWN && cols < MAX_COLS) {
        cols++;
        document.documentElement.style.setProperty("--cols", cols);
        scale = 1.2;
        targetScale = 1;
        snapped = true;
      }

      if (!snapped && Math.abs(targetScale - 1) < 0.001 && Math.abs(scale - 1) < 0.001) {
        scale = 1;
        targetScale = 1;
        gallery.style.transform = "";
        animating = false;
        return;
      }

      const visualScale = Math.max(1, scale);
      gallery.style.transform = visualScale === 1 ? "" : "scale(" + visualScale + ")";
      requestAnimationFrame(tickZoom);
    }

    gallery.addEventListener("wheel", (e) => {
      if (!e.ctrlKey && !e.metaKey) return;
      e.preventDefault();

      const delta = e.deltaY * -0.003;
      const clamped = Math.max(-MAX_VELOCITY, Math.min(MAX_VELOCITY, delta));
      targetScale = Math.max(0.83, Math.min(1.35, targetScale * (1 + clamped)));

      if (!animating) {
        animating = true;
        requestAnimationFrame(tickZoom);
      }
    }, { passive: false });

    // Filtering helpers
    function applyFilter(tag) {
      tiles.forEach(tile => {
        const tags = (tile.dataset.tags || "").split(",").map(t => t.trim());
        const matches = tags.includes(tag);
        tile.style.display = matches ? "" : "none";
      });
    }

    function getTagCount(tag) {
      return tiles.filter(tile => {
        const tags = (tile.dataset.tags || "").split(",").map(t => t.trim());
        return tags.includes(tag);
      }).length;
    }

    function clearFilter() {
      tiles.forEach(tile => {
        tile.style.display = "";
      });
      tagButtons.forEach(btn => {
        btn.classList.remove("is-active");
        btn.textContent = btn.dataset.tag;
      });
    }

    tagButtons.forEach(button => {
      button.addEventListener("click", () => {
        const tag = button.dataset.tag;
        const isAlreadyActive = button.classList.contains("is-active");

        clearFilter();
        if (!isAlreadyActive) {
          button.classList.add("is-active");
          button.textContent = tag + " (" + getTagCount(tag) + ")";
          applyFilter(tag);
        }
      });
    });

    // Clicking the title clears the filter
    if (title) {
      title.addEventListener("click", clearFilter);
    }

    // Email toggle: show address instead of opening mail client
    const emailLink = document.querySelector(".email-toggle");
    if (emailLink) {
      emailLink.addEventListener("click", (e) => {
        e.preventDefault();
        const address = emailLink.dataset.email;
        emailLink.textContent = (emailLink.textContent === address) ? "email" : address;
      });
    }

    // --- Lightbox helpers ---
    function getVisibleTiles() {
      return Array.from(gallery.querySelectorAll(".tile")).filter(t => t.style.display !== "none");
    }

    function readTileData(tile) {
      const img = tile.querySelector("img");
      const meta = tile.querySelector(".meta");
      return {
        src: img ? img.getAttribute("src") : "",
        meta: meta ? meta.textContent.trim() : "",
      };
    }

    function renderLightbox() {
      const tile = activeTiles[currentIndex];
      if (!tile) return;

      const data = readTileData(tile);
      lightboxImg.src = data.src;
      lightboxMeta.textContent = data.meta;

      // meta visibility
      lightbox.classList.toggle("show-meta", showMeta);
      lightboxMeta.setAttribute("aria-hidden", String(!showMeta));

      // fit mode
      lightbox.classList.toggle("fit-contain", fitContain);

      lightboxImg.onload = () => {
        const scrollMax = lightbox.scrollHeight - lightbox.clientHeight;
        lightbox.scrollTop = scrollMax / 2;
      };
      if (lightboxImg.complete) {
        const scrollMax = lightbox.scrollHeight - lightbox.clientHeight;
        lightbox.scrollTop = scrollMax / 2;
      }
    }

    function openLightboxFrom(tile) {
      activeTiles = getVisibleTiles();
      currentIndex = Math.max(0, activeTiles.indexOf(tile));

      isOpen = true;
      showMeta = false;
      fitContain = false;

      lightbox.classList.add("is-open");
      lightbox.setAttribute("aria-hidden", "false");
      document.body.classList.add("no-scroll");

      renderLightbox();
    }

    function closeLightbox() {
      isOpen = false;
      lightbox.classList.remove("is-open", "show-meta", "fit-contain");
      lightbox.setAttribute("aria-hidden", "true");
      document.body.classList.remove("no-scroll");
      clearOverlays();
    }

    function nextImage() {
      if (!activeTiles.length) return;
      currentIndex = (currentIndex + 1) % activeTiles.length;
      renderLightbox();
    }

    function prevImage() {
      if (!activeTiles.length) return;
      currentIndex = (currentIndex - 1 + activeTiles.length) % activeTiles.length;
      renderLightbox();
    }

    // Click any tile to open viewer
    // SHIFT+click toggles the in-grid meta overlay
    function clearOverlays() {
      tiles.forEach(t => t.classList.remove("is-white"));
    }

    tiles.forEach(tile => {
      tile.addEventListener("click", (e) => {
        if (e.shiftKey) {
          const wasActive = tile.classList.contains("is-white");
          clearOverlays();
          if (!wasActive) tile.classList.add("is-white");
          return;
        }
        clearOverlays();
        openLightboxFrom(tile);
      });
    });

    const lightboxArrow = document.getElementById("lightboxArrow");

    lightbox.addEventListener("mousemove", (e) => {
      if (!isOpen) return;
      const quarter = window.innerWidth / 4;
      const inArrowZone = e.clientY > 80 && e.clientY < window.innerHeight - 50;
      const onLeft = e.clientX < quarter;
      const onRight = e.clientX > window.innerWidth - quarter;

      lightboxArrow.style.top = (e.clientY - 12) + "px";
      lightboxArrow.style.left = (e.clientX + 16) + "px";

      if (inArrowZone && onLeft) {
        lightboxArrow.textContent = "\u2190";
        lightboxArrow.style.opacity = "0.9";
        lightbox.style.cursor = "none";
      } else if (inArrowZone && onRight) {
        lightboxArrow.textContent = "\u2192";
        lightboxArrow.style.opacity = "0.9";
        lightbox.style.cursor = "none";
      } else {
        lightboxArrow.style.opacity = "0";
        lightbox.style.cursor = "default";
      }
    });

    lightbox.addEventListener("mouseleave", () => {
      lightboxArrow.style.opacity = "0";
    });

    lightbox.addEventListener("click", (e) => {
      // Don’t treat close button clicks as navigation
      if (e.target === lightboxClose) return;

      if (!isOpen) return;
      if (e.clientX < window.innerWidth / 2) prevImage();
      else nextImage();
    });

    lightboxClose.addEventListener("click", (e) => {
      e.stopPropagation();
      closeLightbox();
    });

    let touchStartX = 0;
    let touchStartY = 0;
    let touchStartTime = 0;
    let isSwiping = false;

    lightbox.addEventListener("touchstart", (e) => {
      if (!isOpen) return;
      if (e.target === lightboxClose) return;
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
      touchStartTime = Date.now();
      isSwiping = false;
    }, { passive: true });

    lightbox.addEventListener("touchmove", (e) => {
      if (!isOpen) return;
      const touch = e.touches[0];
      const dx = Math.abs(touch.clientX - touchStartX);
      const dy = Math.abs(touch.clientY - touchStartY);
      if (dx > 10 || dy > 10) isSwiping = true;
    }, { passive: true });

    lightbox.addEventListener("touchend", (e) => {
      if (!isOpen) return;
      if (e.target === lightboxClose) return;
      const touch = e.changedTouches[0];
      const dx = touch.clientX - touchStartX;
      const dy = touch.clientY - touchStartY;
      const elapsed = Date.now() - touchStartTime;
      const absDx = Math.abs(dx);
      const absDy = Math.abs(dy);

      if (absDx > 50 && absDx > absDy * 1.5) {
        e.preventDefault();
        if (dx < 0) nextImage();
        else prevImage();
        lightbox.scrollTop = 0;
        return;
      }

      if (!isSwiping && elapsed < 300) {
        e.preventDefault();
        showMeta = !showMeta;
        renderLightbox();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (!isOpen) return;

      if (e.key === "Escape") {
        closeLightbox();
        return;
      }
      if (e.key === "ArrowRight") {
        nextImage();
        return;
      }
      if (e.key === "ArrowLeft") {
        prevImage();
        return;
      }
      if (e.key === " " || e.code === "Space") {
        e.preventDefault();
        showMeta = !showMeta;
        renderLightbox();
        return;
      }
      if (e.key.toLowerCase() === "f") {
        fitContain = !fitContain;
        renderLightbox();
        return;
      }
    });
  </script>
</body>
</html>
